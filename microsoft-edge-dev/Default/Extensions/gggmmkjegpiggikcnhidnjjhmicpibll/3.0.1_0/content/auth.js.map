{"version":3,"sources":["webpack://officechromeextension/./app/common/browserHandler.ts","webpack://officechromeextension/./app/content/content.helper.ts","webpack://officechromeextension/webpack/bootstrap","webpack://officechromeextension/./app/content/auth.ts"],"names":["browserListeners","propertyList","browserHandler","browser","edgeBrowser","Object","create","notifications","clear","notificationId","callback","options","priority","window","alert","message","onButtonClicked","addListener","onClicked","runtime","getPlatformInfo","chrome","jasmine","mergeProperties","target","source","key","value","entries","Array","isArray","concat","console","log","mock","browserAction","setIcon","icon","extension","getURL","name","i18n","getUILanguage","getMessage","onMessage","listener","push","removeListener","splice","indexOf","sendMessage","i","length","id","storage","local","get","set","data","hasOwnProperty","remove","tabs","createProperties","BrowserHandler","isIFrame","parent","severity","scriptfile","stack","Error","split","match","pop","activity","filename","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","exports","module","__webpack_modules__","notifyAuthentication","type","params","origin","location","close","assign","hash","href","addEventListener","baseAndParams","URLSearchParams","result","parseParams","state","includes","code","pathname"],"mappings":"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","file":"\\content\\auth.js","sourcesContent":["declare let browser: any;\r\ndeclare let chrome: any;\r\n\r\nvar browserListeners: any[] = [];\r\nvar propertyList = {};\r\n\r\nfunction mergeProperties(target: any, source: any): any {\r\n    for (const [key, value] of Object.entries(source)) {\r\n        if (!target[key]) {\r\n            target[key] = value;\r\n            continue;\r\n        }\r\n\r\n        if (typeof value !== typeof target[key]) {\r\n            console.log(`skipping ${key} due to conflicting types`);\r\n            continue;\r\n        }\r\n\r\n        if (Array.isArray(value)) {\r\n            target[key] = target[key].concat(value);\r\n            continue;\r\n        }\r\n\r\n        if (typeof value === 'object') {\r\n            target[key] = mergeProperties(target[key], value);\r\n            continue;\r\n        }\r\n        target[key] = value;\r\n    }\r\n\r\n    return target;\r\n}\r\n\r\nexport default (function (): any {\r\n    var browserHandler = ((): any => {\r\n        if (typeof browser === 'object') {\r\n            var edgeBrowser = Object.create(browser);\r\n\r\n            edgeBrowser.notifications = {\r\n                clear: function (notificationId: string, callback: (wasCleared: boolean) => void): void {\r\n                    // Invoke callback with wasCleared == false\r\n                    callback(false);\r\n                },\r\n                create: function (\r\n                    notificationId: string,\r\n                    options: chrome.notifications.NotificationOptions,\r\n                    callback: (notificationId: string) => void\r\n                ): void {\r\n                    // Use window alert dialog to display notification message\r\n                    if (typeof options !== 'undefined' && options !== null) {\r\n                        // Only show when priority is 1 or 2\r\n                        if (typeof options.priority !== 'undefined' && options.priority !== null && options.priority > 0) {\r\n                            window.alert(options.message);\r\n                        }\r\n                    }\r\n\r\n                    // Invoke callback with notification id\r\n                    callback(notificationId);\r\n                },\r\n                onButtonClicked: {\r\n                    addListener: function (notificationId: string): void {\r\n                        // Not implemented\r\n                    },\r\n                },\r\n                onClicked: {\r\n                    addListener: function (notificationId: string): void {\r\n                        // Not implemented\r\n                    },\r\n                },\r\n            };\r\n\r\n            edgeBrowser.runtime = {\r\n                getPlatformInfo: function (callback: (platformInfo: chrome.runtime.PlatformInfo) => void): void {\r\n                    // Does not execute the callback function\r\n                    // Not implemented\r\n                },\r\n            };\r\n        } else if (typeof chrome === 'object') {\r\n            return Object.create(chrome);\r\n        }\r\n    })();\r\n\r\n    // when running in tests, provide override the necessary functions\r\n    if ((window as any).jasmine) {\r\n        const browserMock = {\r\n            mock: true,\r\n            browserAction: {\r\n                setIcon: function (icon: string): void {},\r\n            },\r\n            extension: {\r\n                getURL: function (name: any): string {\r\n                    return '';\r\n                },\r\n            },\r\n            i18n: {\r\n                getUILanguage: function (name: any, callback: any): string {\r\n                    return '';\r\n                },\r\n                getMessage: function (): string {\r\n                    return '';\r\n                },\r\n            },\r\n            runtime: {\r\n                onMessage: {\r\n                    addListener: function (listener: any): any {\r\n                        browserListeners.push(listener);\r\n                    },\r\n                    removeListener: function (listener: any): void {\r\n                        browserListeners.splice(browserListeners.indexOf(listener), 1);\r\n                    },\r\n                },\r\n                sendMessage: function (message: any): any {\r\n                    for (let i = 0; i < browserListeners.length; ++i) {\r\n                        browserListeners[i](message);\r\n                    }\r\n                },\r\n                id: 'ndjpnladcallmjemlbaebfadecfhkepb',\r\n            },\r\n            storage: {\r\n                local: {\r\n                    get: function (name: string, callback: (arg0: { [x: number]: any }) => void): any {\r\n                        callback({\r\n                            [name]: (propertyList as any)[name],\r\n                        });\r\n                    },\r\n\r\n                    set: function (data: { [x: string]: any; hasOwnProperty: (arg0: string) => any }): void {\r\n                        for (const key in data) {\r\n                            if (data.hasOwnProperty(key)) {\r\n                                (propertyList as any)[key] = /*JSON.stringify*/ data[key];\r\n                            }\r\n                        }\r\n                    },\r\n\r\n                    remove: function (name: string | number, callback: (arg0: any) => void): void {\r\n                        delete (propertyList as any)[name];\r\n                        callback(propertyList);\r\n                    },\r\n\r\n                    clear: function (name: any, callback: any): void {\r\n                        propertyList = {};\r\n                    },\r\n                },\r\n            },\r\n            tabs: {\r\n                create: function (createProperties: any, callback: (arg0: {}) => void): void {\r\n                    if (callback) callback({});\r\n                },\r\n            },\r\n        };\r\n        browserHandler = mergeProperties(browserHandler || {}, browserMock);\r\n        if (!(window as any).chrome) {\r\n            (window as any).chrome = browserHandler;\r\n        }\r\n    }\r\n\r\n    if (!(window as any).BrowserHandler) {\r\n        (window as any).BrowserHandler = browserHandler;\r\n    }\r\n\r\n    return browserHandler;\r\n})();\r\n","import BrowserHandler from '../common/browserHandler';\r\n\r\n('use strict');\r\n\r\nexport const isIFrame = window.parent !== window;\r\nexport function log(message: string, severity = 'DEBUG'): void {\r\n    var scriptfile = ((): string => {\r\n        var stack = new Error().stack.split('\\n');\r\n        if (stack.length < 4) {\r\n            return undefined;\r\n        }\r\n\r\n        var location = stack[3].match(/\\b[\\w.]+\\b:\\d+/g);\r\n        return location.pop();\r\n    })();\r\n\r\n    BrowserHandler.runtime.sendMessage({\r\n        activity: 'log',\r\n        filename: `${isIFrame ? '(iframe)' : ''}${scriptfile || ''}`,\r\n        severity,\r\n        log: message,\r\n    });\r\n}\r\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","import BrowserHandler from '../common/browserHandler';\r\nimport { isIFrame, log } from './content.helper';\r\n\r\n('use strict');\r\n\r\nlog(`navigated to: ${location.href}`);\r\n\r\nfunction notifyAuthentication(type: string, params: any): void {\r\n    const message = {\r\n        activity: 'authorization',\r\n        origin: window.location.origin,\r\n        type,\r\n        close: true,\r\n    };\r\n\r\n    Object.assign(message, params);\r\n\r\n    // clear the hash so refresh will not cause another notification\r\n    location.hash = '';\r\n    BrowserHandler.runtime.sendMessage(message);\r\n}\r\n\r\nfunction isResponse(): boolean {\r\n    return location.hash.length > 0;\r\n}\r\n\r\nfunction parseParams(href: string): any {\r\n    const baseAndParams = href.split(/[?#]/);\r\n    if (baseAndParams.length < 2) {\r\n        return {};\r\n    }\r\n    href = baseAndParams[1];\r\n    var params = new URLSearchParams(href);\r\n    var result: any = {};\r\n    for (var [name, value] of params.entries()) {\r\n        result[name] = value;\r\n    }\r\n\r\n    return result;\r\n}\r\n\r\n// Function is triggered when the live login window pops up\r\nwindow.addEventListener('load', function (): void {\r\n    const params = parseParams(location.href);\r\n\r\n    if (!(params.state && params.state.includes('OfficeOnlineExtension'))) {\r\n        return;\r\n    }\r\n\r\n    if (window.location.origin === 'https://login.microsoftonline.com') {\r\n        if (params.code) {\r\n            notifyAuthentication('o365UserService', params);\r\n        } else if (isResponse() && location.pathname === '/common/oauth2/nativeclient') {\r\n            notifyAuthentication('msidUserService', params);\r\n        }\r\n    } else if (window.location.origin === 'https://login.live.com') {\r\n        if (params.code) {\r\n            notifyAuthentication('msaUserService', params);\r\n        } else if (location.pathname === '/oauth20_authorize') {\r\n            notifyAuthentication('msidUserService', params);\r\n        }\r\n    }\r\n});\r\n"],"sourceRoot":""}