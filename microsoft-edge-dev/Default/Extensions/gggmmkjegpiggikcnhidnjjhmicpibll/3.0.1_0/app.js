(()=>{var e,t={5939:(e,t,r)=>{"use strict";var n=r(6695),i=r.n(n),o=(r(7828),r(3234),r(8096)),a=(r(454),r(5601));const s={IDTYPE:{MSACID:"MSACID",ORGIDPUID:"OrgIdPUID"},ACTIVITY:{AUTHENTICATION:{NAME:"authentication"},AUTHORIZATION:{NAME:"authorization"},NOTIFICATION:{NAME:"notification"},TELEMETRY:{NAME:"telemetry"},USERINFO_AVAILABLE:{NAME:"userInfoAvailable"},SSO:{NAME:"sso"},LOGOUT:{NAME:"logout"},REQUEST_TOKEN:{NAME:"requestToken"},LOG:{NAME:"log"}},APPINFO_NAME:"OfficeOnlineExtension",FILE:{APPLICATION_IMAGE_PATH:{excel:"assets/excel_doc.png",onenote:"assets/onenote_doc.png",powerpoint:"assets/powerpoint_doc.png",unknown:"assets/generic_doc.png",word:"assets/word_doc.png"},APPLICATION_LABEL:{excel:"ExcelOnlineAppName",onenote:"OneNoteOnlineAppName",powerpoint:"PowerPointOnlineAppName",unknown:"OfficeOnlineAppName",word:"WordOnlineAppName"},ERROR:{FILE_SIZE_MAX_EXCEEDED:"fileSizeMaxExceeded",LOAD_FROM_PATH:"loadFromPath",UNSUPPORTED_FILE_TYPE:"unsupportedFileType"},MAX_SIZE_BYTE_LIMIT:4194304,OFFICE_APP_FILE_ASSOCIATIONS:{EXCEL:"excel",ONENOTE:"onenote",POWERPOINT:"powerpoint",WORD:"word"},OFFICE_MIME_TYPES:{"application/msword":"word","application/vnd.openxmlformats-officedocument.wordprocessingml.document":"word","application/vnd.openxmlformats-officedocument.wordprocessingml.template":"word","application/vnd.oasis.opendocument.text":"word","application/vnd.ms-powerpoint":"powerpoint","application/vnd.openxmlformats-officedocument.presentationml.presentation":"powerpoint","application/vnd.openxmlformats-officedocument.presentationml.slideshow":"powerpoint","application/vnd.oasis.opendocument.presentation":"powerpoint","application/vnd.ms-excel":"excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":"excel","application/vnd.ms-excel.sheet.binary.macroEnabled.12":"excel","application/vnd.ms-excel.sheet.macroEnabled.12":"excel","application/vnd.oasis.opendocument.spreadsheet":"excel"},ORIGIN:{HTML5:"html5",LOCAL_PATH:"local_path"},SUPPORTED_APPLICATIONS:["Word","Excel","PowerPoint","OneNote"],SUPPORTED_FILE_TYPES:{doc:"word",dot:"word",docx:"word",dotx:"word",odt:"word",ppt:"powerpoint",pot:"powerpoint",pps:"powerpoint",pptx:"powerpoint",ppsx:"powerpoint",odp:"powerpoint",xlsx:"excel",xlsm:"excel",xlsb:"excel",ods:"excel",notebook:"onenote"}},JQUERY:{EVENT_ID:{KEYPRESS:{ENTER:13,ARROWLEFT:37,ARROWUP:38,ARROWRIGHT:39,ARROWDOWN:40},MOUSEDOWN:{LEFT_BUTTON_CLICK:1}}},LINKS:{OFFICE_URL:"https://portal.office.com/home",PROGRESSPAGE_URL:"https://onedrive.live.com",SETTINGS_URL:"chrome://extensions",SIGNUP:"https://onedrive.live.com/about",UNINSTALL:"https://contentstorage.osi.office.net/officeonlineextensionuninstall/uninstall.html",OFFICE_HOME_URL:"https://go.microsoft.com/fwlink/?linkid=859986",OFFICE_HOME_DEV_URL:"https://go.microsoft.com/fwlink/?linkid=860665",SUPPORT_URL:"https://aka.ms/officeextsignin",MYACCOUNT_MSA_URL:"https://go.microsoft.com/fwlink/?LinkId=823747",MYACCOUNT_O365_URL:"https://go.microsoft.com/fwlink/?LinkId=824642",APP:{WORD:function(){return`https://office.live.com/start/word.aspx?auth=${arguments[0]}&WT.mc_id=Chrome_OfficeApp`},EXCEL:function(){return`https://office.live.com/start/excel.aspx?auth=${arguments[0]}&WT.mc_id=Chrome_OfficeApp`},POWERPOINT:function(){return`https://office.live.com/start/powerpoint.aspx?auth=${arguments[0]}&WT.mc_id=Chrome_OfficeApp`},ONENOTE:function(){return`https://www.onenote.com/notebooks?auth=${arguments[0]}&WT.mc_id=Chrome_OfficeApp`},SWAY:function(){return`https://www.sway.com/?auth_pvr=${arguments[0]}&auth_upn=${arguments[1]}&WT.mc_id=Chrome_OfficeApp`},SWAY_DEFAULT:"https://www.sway.com/?WT.mc_id=Chrome_OfficeApp",ONEDRIVE:"https://onedrive.live.com",TEAMS:"https://teams.microsoft.com",SHAREPOINT_DEFAULT:"https://products.office.com/sharepoint",OUTLOOK_DEFAULT:"https://outlook.com",OUTLOOK_O365:"https://outlook.office365.com"}},MENU_VIEWMODE:{NONE:0,NEW:1,OPEN:2,ACCOUNT:3,SETTINGS:4},OAUTH:{ACCESS_TOKEN:"access_token",AUTH_CODE:"authorization_code",CODE:"code",EXPIRES_ON:"expires_on",REFRESH_TOKEN:"refresh_token",SERVICE_ENDPOINT:"service_endpoint",SERVICE_ID:"service_id"},O365CONFIG:{CLIENT_ID:"d08f258a-c5dd-4a8f-8afc-9321d67c767a",CLIENT_SECRET:"00000000000000000000000000000000",GRAPH_RESOURCE:"https://graph.microsoft.com",ENDPOINTS:{"officeapps.live.com":"https://officeapps.live.com","graph.microsoft.com":"https://graph.microsoft.com"},INSTANCE:"https://login.windows.net/common/oauth2/",LOGOUT_URI:"https://login.microsoftonline.com/logout.srf",MRU_URL:"https://ocws.officeapps.live.com/ocs/docs/recent/",PHOTO_URL:"https://graph.microsoft.com/v1.0/me/photo/$value",ONEDRIVE_URL:"https://graph.microsoft.com/v1.0/me/drive/root",SHAREPOINT_URL:"https://graph.microsoft.com/v1.0/sites/root",REDIRECT_URI:"https://login.microsoftonline.com/login.srf",UPLOAD_URL:"https://graph.microsoft.com/v1.0/me/drive/root:/",FEDERATED_URL:"https://login.microsoftonline.com/getuserrealm.srf"},MSACONFIG:{CLIENT_ID:"000000004016DA34",CLIENT_SECRET:"00000000000000000000000000000000",INSTANCE:"https://login.live.com/oauth20_authorize.srf",LOGOUT_URI:"https://login.live.com/oauth20_logout.srf",ONEDRIVE_ITEMS_URL:"https://api.onedrive.com/v1.0/drive/items/",PHOTO_URL:"https://apis.live.net/v5.0/me/picture",REDIRECT_URI:"https://login.live.com/oauth20_desktop.srf",SCOPE:"wl.basic+wl.emails+wl.signin+wl.offline_access+onedrive.readwrite+wl.skydrive",URL:"https://login.live.com/oauth20_token.srf",USERINFO_URL:"https://apis.live.net/v5.0/me"},NOTIFICATION:{FILEACCESS:{id:"fileAccess",priority:0,type:"basic",message:"NotificationFileAccess"},FILE_MAX_SIZE_BYTE_LIMIT_REACHED:{id:"fileMaxSizeByteLimitReached",priority:2,type:"basic",message:"NotificationFileMaxSizeByteLimitReached"},FILE_UPLOAD_FAILURE_GENERIC:{id:"fileUploadFailureGeneric",priority:2,type:"basic",message:"NotificationFileUploadFailureGeneric"},FILE_UPLOAD_FAILURE_SERVER:{id:"fileUploadFailureServer",priority:2,type:"basic",message:"NotificationFileUploadFailureServer"},FILE_UPLOAD_FAILURE_UNSUPPORTED_MEDIA:{id:"fileUploadFailureUnsupportedMedia",priority:2,type:"basic",message:"NotificationFileUploadFailureUnsupportedMedia"},FILE_UPLOAD_IN_PROGRESS:{id:"fileUploadInProgress",priority:0,type:"basic",message:"NotificationFileUploadInProgress"},SETDEFAULT:{id:"setDefault",priority:0,type:"basic",message:"NotificationSetDefault"},AUTOSAVE:{id:"autoSave",priority:0,type:"basic",buttons:[{title:"NotificationAutoSaveButton"}]},AUTOSAVETOONEDRIVE:"NotificationAutoSaveToOneDrive",AUTOSAVETOSHAREPOINT:"NotificationAutoSaveToSharePoint",NOTSIGNEDIN:{id:"notSignedIn",priority:2,type:"basic",message:"NotificationNotSignedIn"},UNSUPPORTEDFILETYPE:{id:"unsupportedFileType",priority:2,type:"basic",message:"NotificationUnsupportedFileType"},INVALIDSUBSCRIPTION:{id:"invalidSubscription",priority:2,type:"basic",message:"NotificationInvalidSubscription"},WEBDOCREDIRECT:{id:"webDocRedirect",priority:0,type:"basic",message:"NotificationWebDocRedirect",buttons:[{title:"NotificationWebDocRedirectButton"}]}},ONEDRIVE:{DISPLAY_URL:"https://onedrive.live.com/view.aspx?cid=",INSTANCE:"https://api.onedrive.com/v1.0",QUERY_OPTION:"?@name.conflictBehavior=rename"},RECENTS:{LIST_LENGTH_MSA:3,LIST_LENGTH_O365:3,FILTER:"?apps=powerpoint,word,excel,onenote&sort=date",ONEDRIVE_ENDPOINT:"https://api.onedrive.com/v2.1/drive/recent",DISPLAY_PANEL:{ERROR:0,LIST:1,LOADING:2,NO_DOCS:3,NONE:4},ERROR:{CANCELLED:0,GENERIC:1,NO_DOCS_FOUND:2,UNSUPPORTED_USER_TYPE:3}},SIGNINSTATUS:{UNKNOWN:-1,NONE:0,HASREFRESHTOKEN:1,SIGNEDIN:2},TELEMETRY:{COMMAND:{SET_DISABLED:"setDisabledTelemetry",TRACK_TRACE:"trackTrace",TRACK_EVENT:"trackEvent"},ENABLED_SETTING_STORAGE_KEY:"telemetry_enabled",EVENT_PREFIX:"OO_CHROME_",PII_TYPE:{IDENTITY:10}},USER_TYPE:{MSA:"msa",O365:"aad",NONE:"none"},USER_SERVICE_TYPE:{MSA:"msaUserService",O365:"o365UserService",MSID:"msidUserService",NONE:"noneUserService"},TIMEOUT:{DEFAULT_REQUEST:1e4,USER_INFO_LOOKUP:5e3,USER_INFO_LOOKUP_TEST:50},COPY_PASTE:{TEST:a.s.testCommand,PASTE:a.s.pasteCommand,GET_CLIPBOARD_DATA:a.s.getClipboardDataCommand,GET_AVAILABLE_COMMANDS:a.s.getAvailableCommandsCommand},ERROR_RETRIES:{HTTP_REQUEST:3},BROWSER_ICON:{DEFAULT:"../assets/icon_20.png",INACTIVE:"../assets/icon_inactive_20.png"},SSO:{MESSAGE_CHANNEL:"com.microsoft.browsercore",RESPONSE_STATUS_SUCCESS:"Success",RESPONSE_STATUS_FAIL:"Fail",RESPONSE_CODE_NO_SUPPORT:"NoSupport",RESPONSE_CODE_INVALID:-2147186943}};var c=r(6811);const u=function(e,t,r,n){var i=0;return{request:function(e){return c.default.isUndefinedOrNull(e.timeout)&&(e.timeout=s.TIMEOUT.DEFAULT_REQUEST),e},responseError:function(o){if(o)switch(o.status){case 0:t.debug("httpErrorResponseInterceptor - Request cancelled - "+o.config.url);break;case 401:t.info(`httpErrorResponseInterceptor - ${o.status} - ${o.config.url} - ${JSON.stringify(o.data)}`);break;case 400:if(c.default.isNotUndefinedOrNull(o.data)&&c.default.isNotUndefinedOrNull(o.data.error_codes)&&50001===o.data.error_codes[0]){t.info(`httpErrorResponseInterceptor -  Invalid AADSerivce - ${o.status} - ${JSON.stringify(o.data)}`);break}if(c.default.isNotUndefinedOrNull(o.data)&&c.default.isNotUndefinedOrNull(o.data.error_codes)&&50079===o.data.error_codes[0]){if(t.info(`httpErrorResponseInterceptor -  Interaction required - ${o.status} - ${JSON.stringify(o.data)}`),i<s.ERROR_RETRIES.HTTP_REQUEST)return i++,r((function(){return n.get("$http")(o.config)}),s.TIMEOUT.USER_INFO_LOOKUP);i=0}break;case 404:if(o.config.url.startsWith("https://graph.microsoft.com/v1.0/me/drive"))return e.resolve(o);default:t.error(`httpErrorResponseInterceptor - ${o.status} - ${o.config.url} - ${JSON.stringify(o.data)}`)}return e.reject(o)}}};var l=r(8081);function d(e,t){function r(e){return e.length>8e3?e.substring(0,8e3):e}function n(e,r){try{t.trackTrace(e,r)}catch(e){}}function i(e,t,r,n,i){if(c.default.isBackgroundContext())try{var a=`[${(new Date).toLocaleString(void 0,{month:"numeric",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric"})}] (${function(e){try{const t=new URL(location.href).origin+"/";e=e.toString().replace(t,"")}catch{}return e}(i)}) ${n?n+" ":""} ${e}`;console[t.toLowerCase()](a)}catch{}else o.default.runtime.sendMessage({activity:"log",severity:t,log:e,filename:n,stack:r})}function a(e){return"string"==typeof e?e:JSON.stringify(e)}var s=function(e,t){return function(){var o=[].slice.call(arguments),s=o[0],u=void 0;c.default.isExtensionInDevelopmentMode()&&(u=Error().stack);var d=r(a(s.message?s.message:s));new Promise(e=>{s.stack?e("string"==typeof s.stack?r(s.stack).split("\n"):s.stack):u?(0,l.mapStackTrace)(u,t=>{for(;t[0].match("logDecorator.js");)t.shift();e(t)},{}):e([])}).then(r=>{var a="",u=s.source||location;if(s.filename)a=s.filename;else for(var l of r){var f=l.match(/\b[\w.]+\b:\d+/g);if(f){a=f.pop();break}}i(d,t,r,a,u);var p=(new Date).toLocaleString(void 0,{month:"numeric",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric"});o[0]=`[${p}] ${a?a+" ":""}${t}: ${d}`,c.default.isExtensionInDevelopmentMode()&&e.apply(null,o),"DEBUG"!==t&&n(t,{message:d,stack:"ERROR"===t?r:""})})}};return e.debug=s(e.debug,"DEBUG"),e.info=s(e.info,"INFO"),e.warn=s(e.warn,"WARN"),e.error=s(e.error,"ERROR"),e.getEnabledSetting=function(){return t.getEnabledSetting()},e.setEnabledSetting=function(r){try{t.setEnabledSetting(r)}catch(t){e.error("setEnabledSetting error: "+t)}},e.trackEvent=function(r,n,i){try{t.trackEvent(r,n,i)}catch(t){e.error(`trackEvent error with eventName ${r}: ${t}`)}},e.trackTrace=n,e}window.dumpStorage=()=>{window.chrome&&window.chrome.storage.local.get(null,e=>{console.log(`result '${JSON.stringify(e,"\t")}'`)})};i().module("app.common",[]).config(["$httpProvider","$provide",function(e,t){t.decorator("$log",["$delegate","telemetry",d]),e.interceptors.push("httpInterceptor")}]).factory("storage",["$q","$log",function(e,t){return{get:function(r){var n=e.defer();return o.default.storage.local.get(r,(function(e){t.debug(`storage: get '${JSON.stringify(r)}', result '${JSON.stringify(e)}'`),n.resolve(e)})),n.promise},set:function(e){t.debug(`storage: set items '${JSON.stringify(e)}'`),o.default.storage.local.set(e)},remove:function(r){var n=e.defer();return o.default.storage.local.remove(r,(function(e){t.debug(`storage: remove '${JSON.stringify(r)}', result '${JSON.stringify(e)}'`),n.resolve(e)})),n.promise},clear:function(){var r=e.defer();return o.default.storage.local.clear((function(e){t.debug(`storage: clear result '${JSON.stringify(e)}'`),r.resolve(e)})),r.promise}}}]).factory("notification",["$log","localize",function(e,t){return{show:function(r){if(c.default.isBackgroundContext()){var n;if(void 0!==r.buttons&&null!==r.buttons){n=[];for(var i=0;i<r.buttons.length;++i)n[i]={},n[i].title=t.getLocalizedString(r.buttons[i].title),n[i].iconUrl=r.buttons[i].iconUrl}o.default.notifications.clear(r.id,(function(i){o.default.notifications.create(r.id,{iconUrl:"../assets/icon.png",imageUrl:r.imageUrl,message:t.getLocalizedString(r.message),priority:r.priority,progress:r.progress,title:"",type:r.type,buttons:n},(function(t){null==t&&e.error("CreateNotificationError")}))}))}else o.default.runtime.sendMessage({activity:s.ACTIVITY.NOTIFICATION.NAME,notification:r})}}}]).factory("httpInterceptor",["$q","$log","$timeout","$injector",u]).name;i().module("app.user",[]).config(["$httpProvider","$provide",function(e,t){e.interceptors.push("protectedResourceInterceptor")}]).factory("protectedResourceInterceptor",["$q","$log","$injector",function(e,t,r){var n=r.get("userService");return{request:function(r){var i=e.defer();if(c.default.isUndefinedOrNull(r)||c.default.isUndefinedOrNull(r.headers))return t.error("protectedResourceInterceptor.request: http request config is null or undefined"),i.resolve(r),i.promise;var o=r.headers["X-UserType"];if(c.default.isUndefinedOrNull(o))return i.resolve(r),i.promise;var a=r.headers["X-Resource"];return delete r.headers["X-Resource"],delete r.headers["X-UserType"],n.acquireToken(o,r.url,a).then(e=>{c.default.isUndefinedOrNull(e)?t.warn(`failed to get auth token for type:${o} url: ${r.url}, resource ${a}`):r.headers.Authorization="Bearer "+e,i.resolve(r)}),i.promise},responseError:function(t){if(t&&401===t.status){if(c.default.isNotUndefinedOrNull(t.config)&&(t.config.url===s.O365CONFIG.SHAREPOINT_URL||t.config.url===s.O365CONFIG.PHOTO_URL))return e.reject(t);n.clearToken()}return e.reject(t)}}}]).service("msaUserService",["$log","$injector",function(e,t){this.type=s.USER_TYPE.MSA,this.type=s.USER_SERVICE_TYPE.MSA,this.userType=s.USER_TYPE.MSA,this.getConfig=function(){return{tokenUrl:s.MSACONFIG.URL,params:{client_id:s.MSACONFIG.CLIENT_ID,client_secret:s.MSACONFIG.CLIENT_SECRET,redirect_uri:s.MSACONFIG.REDIRECT_URI},resource:s.ONEDRIVE.INSTANCE,loginUrl:s.MSACONFIG.INSTANCE+"?response_type=code&client_id="+s.MSACONFIG.CLIENT_ID+"&redirect_uri="+s.MSACONFIG.REDIRECT_URI+"&scope="+s.MSACONFIG.SCOPE,logoutUrl:s.MSACONFIG.LOGOUT_URI,photoUrl:s.MSACONFIG.PHOTO_URL,documentsUrl:s.RECENTS.ONEDRIVE_ENDPOINT}},this.lookupUserInfo=async function(e){return new Promise((e,r)=>{var n={oneDriveUrl:s.LINKS.APP.ONEDRIVE};t.get("$http")({method:"GET",url:s.MSACONFIG.USERINFO_URL,headers:{"X-UserType":s.USER_SERVICE_TYPE.MSA}}).then((function(t){var r=t.data;n.email=r.emails.account,n.cid=r.id,e(n)}),(function(){r("msaUser.Service.lookupUserInfo http request failed")}))})},this.getResourceForEndpoint=function(e){return s.MSACONFIG.SCOPE}}]).service("o365UserService",["$log","$injector","notification",function(e,t,r){this.type=s.USER_SERVICE_TYPE.O365,this.userType=s.USER_TYPE.O365,this.getConfig=function(){return{tokenUrl:s.O365CONFIG.INSTANCE+"token",params:{client_id:s.O365CONFIG.CLIENT_ID,client_secret:s.O365CONFIG.CLIENT_SECRET,redirect_uri:s.O365CONFIG.REDIRECT_URI,resource:s.O365CONFIG.GRAPH_RESOURCE},resource:s.O365CONFIG.GRAPH_RESOURCE,loginUrl:s.O365CONFIG.INSTANCE+"authorize?response_type=code&client_id="+s.O365CONFIG.CLIENT_ID+"&redirect_uri="+s.O365CONFIG.REDIRECT_URI+"&response_mode=query",logoutUrl:s.O365CONFIG.LOGOUT_URI,photoUrl:s.O365CONFIG.PHOTO_URL,documentsUrl:s.O365CONFIG.MRU_URL+s.RECENTS.FILTER}},this.getResourceForEndpoint=function(e){var t=this.getConfig().resource;if(c.default.isUndefinedOrNull(e))return t;for(var r in s.O365CONFIG.ENDPOINTS)if(s.O365CONFIG.ENDPOINTS.hasOwnProperty(r)&&e.indexOf(r)>-1){t=s.O365CONFIG.ENDPOINTS[r];break}return t},this.lookupUserInfo=async function(n){var i=function(t){var r={},n=function(t){var r=function(t){var r=/^([^.\s]*)\.([^.\s]+)\.([^.\s]*)$/.exec(t);if(!r||r.length<4)return e.error("The returned id_token is not parseable."),null;return{header:r[1],JWSPayload:r[2],JWSSig:r[3]}}(t);if(!r)return null;try{var n=function(e){if(e=e.replace(/-/g,"+").replace(/_/g,"/"),window.atob)return decodeURIComponent(escape(window.atob(e)));return null}(r.JWSPayload);return n?JSON.parse(n):(this._logstatus("The returned id_token could not be base64 url safe decoded."),null)}catch(t){e.error("The returned id_token could not be decoded: "+t.stack)}return null}(t);n&&n.hasOwnProperty("aud")&&(n.aud.toLowerCase()===s.O365CONFIG.CLIENT_ID.toLowerCase()?(n.hasOwnProperty("upn")?r.email=n.upn:n.hasOwnProperty("email")&&(r.email=n.email),n.hasOwnProperty("puid")&&(r.puid=n.puid),n.hasOwnProperty("tid")&&(r.tid=n.tid)):e.error("IdToken has invalid aud field"));return r}(n.id_token);const o=await async function(){var n={method:"GET",url:s.O365CONFIG.ONEDRIVE_URL,headers:{"X-UserType":s.USER_TYPE.O365}},i=t.get("userService");try{var o=await i.httpRequest(n);return o.webUrl?o.webUrl:Promise.reject("o365UserService.DiscoverServiceEndpoint - Invalid resource")}catch(n){return t.get("userService").clearToken(),r.show(s.NOTIFICATION.INVALIDSUBSCRIPTION),e.error("0365User.getOneDriveUrl failed: %s",n),null}}();i.oneDriveUrl=o;const a=await async function(){var r={method:"GET",url:s.O365CONFIG.SHAREPOINT_URL,headers:{"X-UserType":s.USER_SERVICE_TYPE.O365}},n=t.get("userService");try{var i=await n.httpRequest(r);return i.webUrl?i.webUrl:Promise.reject("No SharePoint info for user")}catch(t){return e.error("0365User.getSharePointUrl failed: %s",t),null}}();return i.sharePointUrl=a||s.LINKS.APP.SHAREPOINT_DEFAULT,i}}]).service("msidUserService",["$log","$injector","notification",function(e,t,r){const n=s.USER_SERVICE_TYPE.MSID;var i=void 0;const o="email openid profile user.read",a="https://graph.microsoft.com/v1.0/me/",c=new URL("https://login.microsoftonline.com/common/oauth2/").toString(),u=(new URL("https://login.live.com/oauth20_authorize.srf").toString(),new URL("nativeclient",c).toString()),l=new URL("v2.0/logoutsession",c).toString(),d=new URL("v2.0/authorize",c).toString(),f=(()=>{var e=new URL(d);return e.search=E({prompt:"select_account"}),e.toString()})();function p(){return i||(i=t.get("userService")),i}function E(e){const t={client_id:"e28ff72c-58a5-49ba-8125-42ec264d7cd0",response_type:"id_token token",redirect_uri:u,scope:o,response_mode:"fragment"};return new URLSearchParams(Object.assign({},t,e)).toString()}async function m(){var e={method:"GET",url:a,headers:{"X-UserType":n}},t={};try{t=function(e){for(const t in e)e.hasOwnProperty(t)&&t.match(/^@odata/i)&&delete e[t];return e}(await p().httpRequest(e))}catch(e){return Promise.reject("msidUser.fetchUserInfo failed: "+e)}return t}async function T(){var t={method:"GET",url:s.O365CONFIG.ONEDRIVE_URL,headers:{"X-UserType":n}};try{var i=await p().httpRequest(t);return i.webUrl?{oneDriveUrl:i.webUrl}:Promise.reject("o365UserService.DiscoverServiceEndpoint - Invalid resource")}catch(t){return r.show(s.NOTIFICATION.INVALIDSUBSCRIPTION),e.error("msidUser.fetchOneDriveUrl failed: "+JSON.stringify(t)),null}}async function N(){var t={method:"GET",url:"https://graph.microsoft.com/v1.0/me/drive",headers:{"X-UserType":n}};try{var r=await p().httpRequest(t),i=parseInt(r.quota.total)/1073741824;return i=Math.round(100*i)/100,e.info(`OneDrive quota: ${JSON.stringify(r.quota,null,"\t")} capacity: ${i}GB`),{driveQuota:r.quota.total,driveQuotaString:i+"GB"}}catch(e){return Promise.reject("msidUser.fetchOneDriveQuota failed: "+e)}}return{type:n,getConfig:function(){return{loginUrl:f,logoutUrl:l,photoUrl:"https://graph.microsoft.com/beta/me/photo/$value",userInfoUrl:a,documentsUrl:"https://graph.microsoft.com/v1.0/me/drive/recent"}},getResourceForEndpoint:function(t){if(!t)return o;const r={"https://graph.microsoft.com":{"/v1.0/me/":o,"/v1.0/me/drive/recent":"Files.ReadWrite.All"},"https://nleditor.osi.office.net":{"/NlEditor/":"https://nleditor.osi.office.net/NlEditor/instrumentation.write"}};try{const e=new URL(t);if(!r.hasOwnProperty(e.origin))return o;const n=r[e.origin],i=e.pathname;return n[Object.keys(n).reduce((e,t)=>i.startsWith(t)&&t.length>e.length?t:e)]}catch(t){return e.warning("msidUser.Service threw an exception: "+t),o}},lookupUserInfo:async function(e){const t=[m(),T(),N()];return(await Promise.all(t)).reduce((e,t)=>Object.assign(e,t))},requestAccessToken:async function(t,r){var i={scope:t,response_type:"token"};r&&r.email&&(i.login_hint=r.email);var o=E(i),a=new URL(d);a.search=o.toString();var s=await p().navigateToAuthEndpoint(a.href,n,!0);return s&&s.access_token?s:(e.info("failed to get token from iframe for resource "+t),Promise.reject("unable to retrieve result from "+a.href))}}}]).factory("userService",["$q","$log","$injector","storage","notification","msaUserService","o365UserService","msidUserService",function(e,t,r,n,i,a,u,l){async function d(e,r,n){var i={};if(!(i=await O(e)))return t.error("userService.acquireToken - Invalid type"),Promise.reject("Invalid userType");!n&&i.getResourceForEndpoint&&(n=i.getResourceForEndpoint(r));var o={};try{if((o=await y(r,n))&&o.access_token&&!D(o.expires_on))return t.debug(`Using cached token with resource:'${n}'${r?" for "+r:""} `),o.access_token;if(!(o=await async function(e,r){if(!e)return t.error("userService.requestAccessToken - Invalid type"),Promise.reject("Invalid userType");const n=await async function(){return C("refresh_token")}();if(n)return async function(e,r,n){if(!e)return t.error("userService.refreshAccessToken - Invalid type"),Promise.reject("Invalid userType");var i=e.getConfig();i.params.grant_type=s.OAUTH.REFRESH_TOKEN,i.params.resource=r,i.params.refresh_token=n;var o={method:"POST",url:i.tokenUrl,headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"},data:new URLSearchParams(i.params).toString()};return await f(o)}(e,r,n);const i=await m();var o=await A(i);if(e.requestAccessToken)var a=await e.requestAccessToken(r,o);return a}(i,n)))return Promise.reject("No tokens available");_(i,r,o)}catch(i){t.error(`userService.acquireToken - failed. reason: ${i}, userType: ${e}, endpoint: ${r}, resource: ${n}`)}return o&&o.access_token&&o.expires_on&&!D(o.expires_on)?o.access_token:null}async function f(e){if(!e)return Promise.reject("Invalid Request");var t=(new Error).stack,n=new Promise((n,i)=>{r.get("$http")(e).then(e=>{n(e.data)},r=>{i(`httpRequest failed for url: ${e.url} reason: ${r.statusText} stack:\n ${t}`)})});return await n}async function p(e){const r=e.type;var n=void 0,o=await O(r),a=!1;if(o){if(e.code){n=r.userType;try{a=!!await async function(e,r){if(!e)return t.error("userService.acquireTokenFromCode - Invalid type"),void Promise.reject("Invalid userService type");var n=e.getConfig();n.params.grant_type=s.OAUTH.AUTH_CODE,n.params.code=r;var i={method:"POST",url:n.tokenUrl,headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"},data:new URLSearchParams(n.params).toString()};const o=await f(i);return await _(e,e.getConfig().resource,o),await b(e,o),o.access_token}(o,e.code)}catch(e){n===s.USER_TYPE.O365&&i.show(s.NOTIFICATION.INVALIDSUBSCRIPTION)}}else e.id_token&&(n=await T(e.id_token)),e.access_token&&(await _(o,o.getConfig().userInfoUrl,e),n||(n=await m()),await b(o,e.id_token)),a=n!==s.USER_TYPE.NONE;return e.error&&("interaction_required"===e.error?g(await m(),!1):t.error(`userService.authenticate - authentication returned error: ${e.error} description: ${e.error_description} request: ${JSON.stringify(e)}`)),t.trackEvent("Authorization",{userType:n,serviceType:r,succeeded:a}),a?Promise.resolve():Promise.reject()}t.error("userService.authenticate - Invalid type")}async function E(){return Promise.all([n.remove("accessToken"),n.remove("refreshToken"),n.remove("userInfo"),n.remove("userType"),n.remove("identity")])}async function m(){return(await n.get("userType")).userType||s.USER_TYPE.NONE}async function T(e){var r="";if(Object.values(s.USER_TYPE).includes(e))r=e;else{var i=function(e){var r=e.scopes||e.scope;if(r&&r.includes("wl."))return{type:s.USER_TYPE.MSA};var n=e.id_token||e;if(!n)return{type:s.USER_TYPE.NONE};const i={"9188040d-6c67-4c5b-b112-36a304b66dad":{type:s.USER_TYPE.MSA,audience:"prod"},"4925308c-f164-4d2d-bc7e-0631132e9375":{type:s.USER_TYPE.MSA,audience:"ppe"},"72f988bf-86f1-41af-91ab-2d7cd011db47":{type:s.USER_TYPE.O365,audience:"prod",domain:"microsoft.com"},"f686d426-8d16-42db-81b7-ab578e110ccd":{type:s.USER_TYPE.O365,audience:"ppe",domain:"microsoft.com"}};try{const{header:e,payload:r}=function(e){var r=/^([^.\s]*)\.([^.\s]+)\.([^.\s]*)$/.exec(e);if(!r||r.length<4)return t.error("userService.parseJwtToken - The returned id_token is not parseable."),null;var n=JSON.parse(F(r[1])),i=JSON.parse(F(r[2]));return{header:n,payload:i}}(n);var o={tenant:r.tid};if(i.hasOwnProperty(o.tenant)){var a=i[o.tenant];o=Object.assign(o,a)}else o.type=s.USER_TYPE.O365;return o}catch(e){return{type:s.USER_TYPE.MSA}}}(e);r=i.type,delete i.type;var o={[r]:i},a=await U();R(a,o),await n.set({identity:a})}return r!==s.USER_TYPE.NONE&&await n.set({userType:r}),r}function N(e){e.state&&(e.state=decodeURIComponent(e.state));var[t,r,n]=e.state.split("|");return r&&(e.type=r),e}async function S(e,r,n){return new Promise(async(i,a)=>{if(c.default.isBackgroundContext()){const c=(e=new URL(e)).searchParams;for(const e of["state","nonce"]){var u=c.get(e);u||(u=x()),"state"===e&&r&&(u+="|"+r+"|"+s.APPINFO_NAME),c.set(e,u)}var l=void 0,d=void 0;function f(){if(o.default.runtime.onMessage.removeListener(E),l){var e=document.getElementById(l);e&&e.parentNode.removeChild(e)}}const T=c.get("state"),S=c.get("scope");t.info(`loading auth url:${e.href} ${n?"in iframe":""}`);var p=await A();function E(r,n,c){if(n.id===o.default.runtime.id){if(r.activity===s.ACTIVITY.AUTHORIZATION.NAME){var u=N(r);u||(t.error(`userService.listener - auth url:${e} returned null response `),a(u)),u.state!==T&&t.warn(`userService.listener - auth url:${e} mismatched state:${u.state}`),t[u.error?"error":"debug"](`userService.listener - auth response:${JSON.stringify(u)} received from url:${e}`),d&&clearTimeout(d),delete u.activity,f(),i(u)}}else t.debug("auth listener rejected invalid id: "+n.id)}if(p&&p.email&&!c.has("login_hint")&&c.set("login_hint",p.email),o.default.runtime.onMessage.addListener(E),n){c.set("prompt","none"),l="authFrame!"+S;const r=6e4;d=setTimeout(()=>{t.warn(`userService.authInFrame timed out waiting for ${e.toString()} after ${r} ms`),f(),a("Timed out waiting for response from iFrame")},r);var m=document.getElementById(l);m||((m=document.createElement("iframe")).setAttribute("id",l),m.style.visibility="hidden",m.style.position="absolute",m.style.width=m.style.height="0",m.style.border="0",m.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms"),document.body.appendChild(m),m.src=e.toString())}else o.default.tabs.create({url:e.toString()})}else o.default.runtime.sendMessage({activity:"requestToken",data:{url:e,type:r,inIFrame:n}},e=>{i(e)})})}async function g(e,r=!0){!0===r&&E();var n=await O(e);if(n.handleLogin)return n.handleLogin();var i=n.getConfig().loginUrl;if(i)return S(i,n.type);t.error("userService.login - Invalid type")}async function h(){const e=await m();var r=await O(e);if(E(),r.handleLogout)await r.handleLogout();else{var n=r.getConfig().logoutUrl;if(!n)return void t.error("userService.logout - Invalid type");var i={method:"GET",url:n};await f(i)}t.debug("userService.logout - "+e)}async function I(e){return void 0!==e&&n.set({authNext:{override:e}}),v({noLogout:!0})}async function v(e){var r=new Date;const i=r.toUTCString();var o=await n.get("authNext");r=Math.round(r/1e3);var a=0;if(o.authNext&&o.authNext.lastCheck&&c.default.isNotUndefinedOrNull(o.authNext.flighted)&&(a=r-o.authNext.lastCheck,(!e||!0!==e.force)&&a<864e5&&o.authNext.flighted))return o.authNext.flighted;t.info("checkTransitionAuth time:"+i);var u=await(async()=>{var e={url:"https://nleditor.osi.office.net/NLEditor/api/V1/BrowserExtension",method:"POST",accept:"application/json",contentType:"application/json",headers:{"X-UserId":await async function(){var e=await n.get("deviceId");if(e.deviceId)return e.deviceId;var t=x();return await n.set({deviceId:t}),t}()},data:{AppId:"OfficeBX_Online"}},r={};try{r=await f(e)}catch(e){t.error("userService.checkAuthFlighting - Call to editor service failed. error:"+JSON.stringify(e))}var i=!1;if(r&&r.FeatureFlags&&r.FeatureFlags.authNext){var o=r.FeatureFlags.authNext;i="string"==typeof o?"true"===o.toLowerCase():!!o}return t.info("editor featureFlags.authNext returned:"+i),i})();if(await n.set({authNext:{flighted:u,lastCheck:r}}),o.authNext&&c.default.isNotUndefinedOrNull(o.authNext.override))return t.info("using authNext override from local storage."),o.authNext.override;var l=await C("service");u!==(l===s.USER_SERVICE_TYPE.MSID)&&(t.trackEvent("AuthNext",{elapsed:a,authNext:u,serviceType:l}),e&&!e.noLogout&&await h())}async function O(e){var r=null;return Object.values(s.USER_SERVICE_TYPE).includes(e)||(e=await async function(e){var t=await C("service",e);if(t)return t;if(t=s.USER_SERVICE_TYPE.NONE,await I())return s.USER_SERVICE_TYPE.MSID;switch(e){case s.USER_TYPE.MSA:t=s.USER_SERVICE_TYPE.MSA;break;case s.USER_TYPE.O365:t=s.USER_SERVICE_TYPE.O365}return t}(e)),-1!==e.indexOf(s.USER_SERVICE_TYPE.MSA)?r=a:-1!==e.indexOf(s.USER_SERVICE_TYPE.O365)?r=u:-1!==e.indexOf(s.USER_SERVICE_TYPE.MSID)?r=l:t.error("userService.getServiceProvider - Invalid type - "+e),r}async function U(){var e=await n.get("identity");return e&&e.identity?e.identity:{}}function R(e,r){for(var[n,i]of Object.entries(r))i&&(e[n]&&"none"!==e[n]&&"none"!==i?typeof i==typeof e[n]?Array.isArray(i)?i.forEach(t=>{e[n].indexOf(t)<0&&e[n].push(t)}):"object"!=typeof i?e[n]=i:R(e[n],i):t.warn(`skipping ${n} due to conflicting types`):e[n]=i)}function w(e){return new URL(e).origin}async function _(e,r,i){if(i.expires_in&&!i.expires_on&&(i.expires_on=c.default.getCurrentTime()+Number(i.expires_in)),r){var o=await m();if(o===s.USER_TYPE.NONE&&(o=await T(i)),o!==s.USER_TYPE.NONE){var a=decodeURIComponent(i.scope).toLowerCase().split(/[ +]/);for(const e of a){var u=e.match(/(^https:\/\/[.\w]*(?:\S+\/))/i);if(u){r=u[u.index];break}}r=w(r),i.resource&&i.resource!==r&&(t.info(`saveTokens ${r} does not match ${i.resource}`),r=i.resource);var l={[o]:{id_token:i.id_token,refresh_token:i.refresh_token,service:e.type,resources:{[r]:{access_token:i.access_token,expires_in:i.expires_in,expires_on:i.expires_on,scope:a}}}},d=await U();R(d,l),await n.set({identity:d})}else t.error("userService.saveTokens - unable to resolve userType")}else t.error("userService.saveTokens - endpoint not provided")}function P(e,t){if(!e)return!0;if(!t)return!1;Array.isArray(e)||(e=e.toLowerCase().split(/[ +]/));for(const r of e)if(!t.includes(r))return!1;return!0}async function y(e,r){if(e){e=w(e);try{var n=await C("resources");if(n[e]){var i=n[e];if(e===r)return i;if(i&&P(r,i.scope))return i;delete n[e]}for(const e in n)if(P(r,e.scope))return e;return null}catch(e){return null}}else t.error("userService.getAccessToken - endpoint not provided")}async function A(e){return C("userInfo",e)}async function C(e,t){t||(t=await m());var r=await U();return r[t]&&r[t][e]?r[t][e]:null}async function L(e,t,r){var i=await U(),o={};i[e]&&i[e].userInfo&&!r&&(o=i[e].userInfo),R(o,t),i[e]&&(i[e].userInfo=o,await n.set({identity:i}))}function D(e){var t=c.default.getCurrentTime();return!(e&&e>t+120)}async function b(e,t){var r=await m(),n=await e.lookupUserInfo(t);o.default.runtime.sendMessage({activity:s.ACTIVITY.USERINFO_AVAILABLE.NAME,data:n}),!n.email&&n.userPrincipalName&&(n.email=n.userPrincipalName),await L(r,n,!0),await k(e)}function F(e){return e=e.replace(/-/g,"+").replace(/_/g,"/"),decodeURIComponent(escape(window.atob(e)))}async function k(e){const r=e.type,n=await m();var i=e.getConfig().photoUrl;if(i){var o={method:"GET",url:i,responseType:"blob",headers:{"X-UserType":r}};try{const e=await f(o);t.trackEvent("UserService_GotServerPhoto",{userType:n});var a=new FileReader;a.onload=async()=>(L(n,{photo:a.result}),a.result),a.readAsDataURL(e)}catch(e){return null}}}function x(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){let t=performance.now();const r=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"===e?r:3&r|8).toString(16)}))}return c.default.isBackgroundContext()&&o.default.runtime.onMessage.addListener((function(e,t,r){switch(e.activity){case s.ACTIVITY.LOGOUT.NAME:return h().then(()=>{r()}),!0;case s.ACTIVITY.AUTHENTICATION.NAME:return g(e.type).then(e=>{r(e)}),!0;case s.ACTIVITY.AUTHORIZATION.NAME:return t.id===o.default.runtime.id&&e.close&&(t.tab&&t.tab.id&&o.default.tabs.remove(t.tab.id),delete e.close),p(N(e)).then(()=>{r()}),!0;case s.ACTIVITY.REQUEST_TOKEN.NAME:return S(e.data.url,e.data.type,e.data.inIFrame).then(e=>{r(e)}),!0;default:return}})),window.useAuthNext=I,window.checkTransitionAuth=v,c.default.isBackgroundContext()&&async function(){t.debug("initCheckTransition"),await v(),setInterval(v,864e5)}(),{acquireToken:d,clearToken:E,isLoggedIn:async function(){var e=await n.get(["userType","identity"]);return e.identity&&e.userType&&e.userType!==s.USER_TYPE.NONE},getEndpointUrlForCurrentUser:async function(e){const t=await m();if(!t||t===s.USER_TYPE.NONE)return null;var r=await O(t);return r?r.getConfig()[e]:null},getUserType:m,getUserInfo:A,getUserPhoto:async function(){var e=await m();if(e===s.USER_TYPE.NONE)return t.warn("UserService.getUserPhoto: no signed-in user"),Promise.reject(s.RECENTS.ERROR.UNSUPPORTED_USER_TYPE);var r=await A(e);return r&&r.photo?(t.trackEvent("UserService_GotLocalPhoto",{userType:e}),r.photo):Promise.reject("No photo in local storage")},httpRequest:f,navigateToAuthEndpoint:S,saveUserInfo:L,waitForUserInfo:async function(e){return new Promise(async r=>{var n=await A(e);if(c.default.isNotUndefinedOrNull(n))return r(n);o.default.runtime.onMessage.addListener(u);var i=c.default.isExtensionInTestingMode()?s.TIMEOUT.USER_INFO_LOOKUP_TEST:s.TIMEOUT.USER_INFO_LOOKUP,a=setTimeout(()=>{t.warn(`userService.waitForUserInfo timed out after ${s.TIMEOUT.USER_INFO_LOOKUP} ms - ${e}`),l(),r(n)},i);function u(e){e.activity===s.ACTIVITY.USERINFO_AVAILABLE.NAME&&(l(),clearTimeout(a),r(e.data))}function l(){o.default.runtime.onMessage.removeListener(u)}})},getUserLicenseInfo:async function(){var e=await A();return["driveQuota","licenses"].reduce((t,r)=>(e[r]&&(t[r]=e[r]),t),{})},useAuthNext:I,authorize:p,getAccessToken:y,getPhotoFromServer:k,login:g,logout:h,lookupUserInfo:b}}]).name;const f=function(e,t,r,n){async function i(e,t){return new Promise((n,i)=>{r({method:"GET",accept:"application/json",url:t,contentType:"application/json",headers:{"X-UserType":e}}).then((function(e){n(e.data)}),(function(){i(s.RECENTS.ERROR.GENERIC)}))})}async function o(e,t){var n={method:"GET",accept:"application/json",url:"https://graph.microsoft.com/v1.0/me/drive/items/"+t,contentType:"application/json",headers:{"X-UserType":e}};try{return new Promise(e=>{r(n).then((function(t){e(t.data)}))})}catch(e){return Promise.resolve({})}}async function a(e){var t={method:"GET",accept:"application/json",url:"https://graph.microsoft.com/v1.0/me/drive/sharedWithMe",contentType:"application/json",headers:{"X-UserType":e}};return new Promise(e=>{try{r(t).then((function(t){e(t.data)}))}catch(t){e({})}})}const u={"application/vnd.openxmlformats-officedocument.wordprocessingml.document":"word","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":"excel","application/vnd.openxmlformats-officedocument.presentationml.presentation":"powerpoint","application/msonenote":"onenote"};function l(e){var t=[];if(c.default.isUndefinedOrNull(e))return t;for(const f of e){if(f.DocumentUrl&&f.Timestamp&&f.Application&&f.FileName){t.push(f);continue}if(!f.remoteItem)continue;const e=f.name||f.remoteItem.name,p=f.id||f.remoteItem.id;if(e&&p){var r=f.remoteItem,n=void 0,i=void 0,o=void 0;if(r.mru){var a=r.mru;a.app&&-1!==s.FILE.SUPPORTED_APPLICATIONS.indexOf(a.app)&&(n=a.url,i=a.timeStamp,o=a.app.toLowerCase())}else{if(!(n=r.webDavUrl||r.webUrl))continue;const t=s.FILE.SUPPORTED_FILE_TYPES;var l=c.default.getFileExtension(n)||c.default.getFileExtension(e);if(t.hasOwnProperty(l))o=t[l];else if(r.file&&r.file.mimeType&&u.hasOwnProperty(r.file.mimeType))o=u[r.file.mimeType];else if(!o){var d=r.package||f.package;if(!d||!d.type)continue;if(o=d.type.toLowerCase(),!Object.values(t).includes(o))continue}if(!o)continue;if(r.lastModifiedDateTime?i=r.lastModifiedDateTime:r.fileSystemInfo&&(i=r.fileSystemInfo.lastAccessedDateTime||r.fileSystemInfo.lastModifiedDateTime),!i)continue}t.push({DocumentUrl:n,Timestamp:i,Application:o,FileName:e,Id:p})}}return t}return{getRecentDocumentList:async function(){const e=await n.getUserType();if(e===s.USER_TYPE.NONE)return Promise.reject(s.RECENTS.ERROR.UNSUPPORTED_USER_TYPE);const t=await n.getEndpointUrlForCurrentUser("documentsUrl");var r=await i(e,t);return await async function(e,t){if(t.value){var r=void 0;for(var n of t.value)if(!Object.values(n.remoteItem).length){if(!r){var i=await a(e);if(!i.value)return;r=i.value}var s=r.find(e=>e.remoteItem&&e.remoteItem.id&&e.remoteItem.id.toLowerCase()===n.id.toLowerCase());if(s)n.remoteItem=s.remoteItem;else{var c;try{c=await o(e,n.id)}catch(e){continue}c&&c.id&&(n.remoteItem.webUrl=c.webUrl,n.name=c.name,n.file||(n.file=c.file),n.remoteItem.package||(n.remoteItem.package=c.package),n.remoteItem.lastModifiedDateTime||(n.remoteItem.lastModifiedDateTime=c.lastModifiedDateTime))}}}}(e,r),l(r.data||r.value||r)},getRecentDocs:i,normalizeMruList:l}};const p=function(e,t,r,n,i){var o=this;o.onLoad=function(){r.debug("Loading MruController"),o.currentDisplayPanel=o.constants.RECENTS.DISPLAY_PANEL.LOADING,o.getRecentDocumentsFromStorage().then((function(e){!c.default.isUndefinedOrNull(e)&&e.length>0&&(o.recentDocuments=e,o.currentDisplayPanel=o.constants.RECENTS.DISPLAY_PANEL.LIST)}))},o.openRecentDocument=function(e,t){r.trackEvent("PopupOpenRecentDocument",{application:e.application}),c.default.navigateToUrlWithNewTab(e.url,!(!c.default.isUndefinedOrNull(t)&&!c.default.isUndefinedOrNull(t.ctrlKey)&&t.ctrlKey)),window.close()},o.constants=s,o.storage=n,o.currentDisplayPanel=o.constants.RECENTS.DISPLAY_PANEL.LOADING,o.recentDocuments=[],o.LIST_LENGTH=o.constants.RECENTS.LIST_LENGTH_MSA,e.$watch("userType",(function(e){e!==o.constants.USER_TYPE.NONE&&(o.LIST_LENGTH=e===o.constants.USER_TYPE.O365?o.constants.RECENTS.LIST_LENGTH_O365:o.constants.RECENTS.LIST_LENGTH_MSA,o.refreshRecentDocumentsList().then((function(){o.currentDisplayPanel=!c.default.isUndefinedOrNull(o.recentDocuments)&&o.recentDocuments.length>0?o.constants.RECENTS.DISPLAY_PANEL.LIST:o.constants.RECENTS.DISPLAY_PANEL.NO_DOCS}),(function(e){r.debug("MruController $scope.$watch error on refreshRecentDocumentsList: "+e),o.currentDisplayPanel=!c.default.isUndefinedOrNull(o.recentDocuments)&&o.recentDocuments.length>0?o.constants.RECENTS.DISPLAY_PANEL.LIST:o.constants.RECENTS.DISPLAY_PANEL.ERROR})))})),this.refreshRecentDocumentsList=function(){var e=t.defer();return r.debug("MruController.refreshRecentDocumentsList(): Method start"),i.getRecentDocumentList().then((function(t){c.default.isUndefinedOrNull(t)&&(t=[]);for(var n=[],i=0,a=0;a<t.length&&i<o.LIST_LENGTH;a++)c.default.isUndefinedOrNull(t[a].Application)?r.warn("Undefined document application with document type "+c.default.getFileExtension(t[a].FileName)):o.isFileDataValid(t[a].FileName,t[a].Application,t[a].DocumentUrl,t[a].Timestamp)&&(n.push({appLabel:o.constants.FILE.APPLICATION_LABEL[t[a].Application.toLowerCase()],application:t[a].Application,lastAccessed:new Date(t[a].Timestamp).toLocaleDateString(),imageSource:"../"+o.constants.FILE.APPLICATION_IMAGE_PATH[t[a].Application.toLowerCase()],name:o.shortenFilename(t[a].FileName),url:o.createOpenInWebUrl(t[a].DocumentUrl),id:t[a].Id}),i++);o.mruListsEqual(o.recentDocuments,n)||(o.recentDocuments=n,o.setRecentDocumentsToStorage(n)),e.resolve()}),(function(t){e.reject(t)})),e.promise},this.mruListsEqual=function(e,t){if(c.default.isUndefinedOrNull(e)||c.default.isUndefinedOrNull(t)||e.length!==t.length)return!1;for(var r=0;r<t.length;r++)if(t[r].name!==e[r].name||t[r].url!==e[r].url||t[r].lastAccessed!==e[r].lastAccessed)return!1;return!0},this.getRecentDocumentsFromStorage=function(){var e=t.defer();return n.get("localRecentDocuments").then((function(t){e.resolve(t.localRecentDocuments)})),e.promise},this.setRecentDocumentsToStorage=function(e){n.set({localRecentDocuments:e})},this.isFileDataValid=function(e,t,r,n){return!(c.default.isUndefinedOrNull(t)||!o.constants.FILE.APPLICATION_LABEL[t.toLowerCase()])&&(c.default.isNotUndefinedOrNull(e)&&c.default.isNotUndefinedOrNull(r)&&c.default.isNotUndefinedOrNull(n))},this.createOpenInWebUrl=function(e){return o.constants.FILE.SUPPORTED_FILE_TYPES[c.default.getFileExtension(e)]?e+"?web=1":e},this.shortenFilename=function(e){return e.replace(/\.[^/.]+$/,"")}};i().module("app.mru",[]).factory("mruService",["$q","$log","$http","userService",f]).controller("MruController",["$scope","$q","$log","storage","mruService",p]).name;var E=r(6076);i().module("app.diagnostics",[]).service("telemetry",["$injector","ariaTelemetry",function(e,t){var r=[t],n=async function(t){var r=e.get("userService");c.default.isUndefinedOrNull(t)&&(t={}),t.pii=[];var n=c.default.getManifest();n&&(t.appVersion=n.version);var i=o.default.i18n.getUILanguage();c.default.isNotUndefinedOrNull(i)&&(t.language=i),t["AppInfo.Name"]=s.APPINFO_NAME;var a=await r.getUserType(),u=E.AWTLogManager.getSemanticContext();if(a===s.USER_TYPE.NONE)return u.setUserId("","",""),t;var l=await r.getUserInfo(a);return c.default.isUndefinedOrNull(l)?(u.setUserId("","",""),t):(c.default.isNotUndefinedOrNull(l.cid)&&(t.cid=l.cid,u.setUserId(l.cid),t["UserInfo.IdType"]=s.IDTYPE.MSACID),c.default.isNotUndefinedOrNull(l.features)&&(t.experimentFeatures=l.features),c.default.isNotUndefinedOrNull(l.puid)&&(t.pii.push({type:s.TELEMETRY.PII_TYPE.IDENTITY,name:"puid",value:l.puid}),u.setUserId(l.puid),t["UserInfo.IdType"]=s.IDTYPE.ORGIDPUID),c.default.isNotUndefinedOrNull(l.tid)&&(t["UserInfo.OMSTenantId"]=l.tid),t)},a=function(){var t=e.get("$q"),r=e.get("storage"),n=t.defer();return r.get(["telemetry_enabled","enableTelemetry"]).then((function(e){n.resolve(!(!c.default.isUndefinedOrNull(e)&&!0!==function(e,t){if(e[t]){var r=JSON.parse(e[t]);if(void 0!==r.value)return JSON.parse(r.value)}}(e,"enableTelemetry")&&!c.default.isUndefinedOrNull(e.telemetry_enabled)&&!0!==e.telemetry_enabled))})),n.promise};return{getEnabledSetting:function(){return a()},setEnabledSetting:function(t){if(c.default.isBackgroundContext()){!function(t){e.get("storage").set({telemetry_enabled:t,enableTelemetry:JSON.stringify({value:JSON.stringify(t),lastUpdate:Date.now(),manualOverride:!1})})}(t);for(var n=0;n<r.length;++n)r[n].setEnabledSetting(t)}else o.default.runtime.sendMessage({activity:s.ACTIVITY.TELEMETRY.NAME,command:s.TELEMETRY.COMMAND.SET_DISABLED,enabled:t})},trackEvent:async function(e,t,a){if(!i().isUndefined(e)&&i().isString(e))if(c.default.isBackgroundContext()){t=await n(t);for(var u=0;u<r.length;++u){var l=i().extend({},t);r[u].trackEvent(e,l,a)}}else o.default.runtime.sendMessage({activity:s.ACTIVITY.TELEMETRY.NAME,command:s.TELEMETRY.COMMAND.TRACK_EVENT,eventName:e,properties:t,measurements:a})},trackTrace:async function(e,t){if(!i().isUndefined(e)&&i().isString(e))if(c.default.isBackgroundContext()){t=await n(t);for(var a=0;a<r.length;++a){var u=i().extend({},t);r[a].trackTrace(e,u)}}else o.default.runtime.sendMessage({activity:s.ACTIVITY.TELEMETRY.NAME,command:s.TELEMETRY.COMMAND.TRACK_TRACE,message:e,properties:t})}}}]).service("ariaTelemetry",["$window",function(e){var t=function(e,t){if(!c.default.isUndefinedOrNull(e)&&!c.default.isUndefinedOrNull(t)){if(!c.default.isUndefinedOrNull(t.pii)){for(var r=0;r<=t.pii.length-1;++r)e.setProperty(t.pii[r].name,t.pii[r].value,t.pii[r].type);delete t.pii}for(var n in t)t.hasOwnProperty(n)&&e.setProperty(n,t[n])}},r=!0;this.setEnabledSetting=function(e){r=e},this.trackEvent=function(n,i,o){if(r){n=n.replace(/\./g,"_");var a=new E.AWTEventProperties;a.setName(s.TELEMETRY.EVENT_PREFIX+n),t(a,i),t(a,o),e.ariaLogger.logEvent(a)}},this.trackTrace=function(n,i){if(r){var o=new E.AWTEventProperties;o.setName(s.TELEMETRY.EVENT_PREFIX+n),o.setProperty("severity",n),t(o,i),e.ariaLogger.logEvent(o)}}}]).name;r(8944);var m=r(2535),T=r.n(m);i().module("app.popup",["ngRoute"]).controller("PopupController",["$timeout","$scope","$q","$log","$document","storage","userService","localize","notification",function(e,t,r,n,i,a,u,l,d){var f=this;function p(){n.trackEvent("PopupSignOutLinkClick"),o.default.runtime.sendMessage({activity:s.ACTIVITY.LOGOUT.NAME,type:t.userType}),f.hasSignedIn=s.SIGNINSTATUS.NONE,t.userType=s.USER_TYPE.NONE,a.remove("localRecentDocuments")}async function E(){n.trackEvent("PopupOpenDocument",{userType:t.userType});var e=await f.userService.getUserInfo(t.userType);c.default.isUndefinedOrNull(e)?n.warn("PopupController.openDocument(): invalid userInfo"):c.default.isUndefinedOrNull(e.oneDriveUrl)?n.warn("PopupController.openDocument(): invalid OneDriveUrl"):c.default.navigateToUrlWithNewTab(e.oneDriveUrl,!0)}function m(){return t.userType===s.USER_TYPE.O365}f.accountPanelOpened=!1,f.filesSelected=null,f.webRedirectInputChecked=!1,f.telemetryInputChecked=!1,f.onLine=!0,f.username="",f.profilePicture="",f.rtl=c.default.isRTL(),f.isChrome=c.default.isChrome(),f.useAuthNext=!1,f.appDescriptionMessage=l.getLocalizedString("AppDescription"),f.onMenuItemClick=function(e){f.currentViewMode=f.currentViewMode===e?s.MENU_VIEWMODE.NONE:f.currentViewMode=e},f.onSignOutClick=function(){f.currentViewMode=s.MENU_VIEWMODE.NONE,f.hasSignedIn===s.SIGNINSTATUS.SIGNEDIN&&p()},f.onWelcomeSignInClick=async function(e){return n.trackEvent("PopupSignInLinkClick"),window.close(),new Promise(async t=>{o.default.runtime.sendMessage({activity:s.ACTIVITY.AUTHENTICATION.NAME,type:e},e=>{t(),n.debug("onWelcomeSignInClick sendMessage returned "+e)})})},f.onProfileClick=function(){f.accountPanelOpened=!f.accountPanelOpened},f.onSignOutLinkClick=p,f.onSignupLinkClick=function(){n.trackEvent("PopupSignupLinkClick"),c.default.navigateToUrlWithNewTab(s.LINKS.SIGNUP,!0)},f.onWebRedirectInputChange=function(){f.webRedirectInputChecked=!f.webRedirectInputChecked,f.storage.set({webRedirect_disabled:!f.webRedirectInputChecked}),n.trackEvent("PopupWebRedirectChecked",{enabled:f.webRedirectInputChecked})},f.onTelemetryInputChange=function(){f.telemetryInputChecked=!f.telemetryInputChecked,n.setEnabledSetting(f.telemetryInputChecked),n.trackEvent("PopupTelemetryInputChecked",{enabled:f.telemetryInputChecked})},f.onFileInputChange=function(){f.loadFile(),n.trackEvent("PopupFileInputChange")},f.openDocument=E,f.openOfficeHome=function(){c.default.navigateToUrlWithNewTab(s.LINKS.OFFICE_HOME_URL,!0)},f.openSupportPage=function(){var e=s.LINKS.SUPPORT_URL;c.default.navigateToUrlWithNewTab(e,!0)},f.openMyAccountPage=function(){var e=m()?s.LINKS.MYACCOUNT_O365_URL:s.LINKS.MYACCOUNT_MSA_URL;c.default.navigateToUrlWithNewTab(e,!0)},f.browseToRecents=async function(){n.trackEvent("PopupBrowseToRecents",{userType:t.userType});var e=await f.userService.getUserInfo(t.userType);if(c.default.isUndefinedOrNull(e))return void n.warn("PopupController.browseToRecents(): invalid userInfo");if(c.default.isUndefinedOrNull(e.oneDriveUrl))return void n.warn("PopupController.browseToRecents(): invalid OneDriveUrl");var r=new URL(e.oneDriveUrl);if(!m()){var i=new URLSearchParams(r.search);i.append("qt","mru"),r.search=i.toString()}c.default.navigateToUrlWithNewTab(r.toString(),!0)},f.createDocument=function(e,r){var i;if(n.trackEvent("PopupCreateDocument",{application:e.id}),"OneDrive"===e.id)return void E();if("Outlook"===e.id)i=m()?s.LINKS.APP.OUTLOOK_O365:s.LINKS.APP.OUTLOOK_DEFAULT;else{if("SharePoint"===e.id)return void async function(){var e=await f.userService.getUserInfo(t.userType);if(c.default.isNotUndefinedOrNull(e)&&c.default.isNotUndefinedOrNull(e.sharePointUrl))return void c.default.navigateToUrlWithNewTab(e.sharePointUrl,!0);n.warn("PopupController.openDocument(): invalid sharePointUrl"),c.default.navigateToUrlWithNewTab(s.LINKS.APP.SHAREPOINT_DEFAULT,!0)}();if("function"==typeof e.url){const t=f.hasSignedIn!==s.SIGNINSTATUS.SIGNEDIN?"0":m()?"2":"1";i=e.url(t)}else i=e.url}c.default.navigateToUrlWithNewTab(i,!(!c.default.isUndefinedOrNull(r)&&!c.default.isUndefinedOrNull(r.ctrlKey))||!r.ctrlKey)},f.handleTableNavigation=function(e){var t=e.which||e.keyCode||0;if(![s.JQUERY.EVENT_ID.KEYPRESS.ARROWLEFT,s.JQUERY.EVENT_ID.KEYPRESS.ARROWUP,s.JQUERY.EVENT_ID.KEYPRESS.ARROWRIGHT,s.JQUERY.EVENT_ID.KEYPRESS.ARROWDOWN].includes(t))return;var r=e.target.closest(".app_table_cell"),n=r.closest(".app_table_row");if(!r||!n)return;var i,o=r.previousElementSibling;switch(t){case s.JQUERY.EVENT_ID.KEYPRESS.ARROWLEFT:i=r.previousElementSibling;break;case s.JQUERY.EVENT_ID.KEYPRESS.ARROWUP:var a=n.previousElementSibling;a&&(i=a.querySelector(".app_table_cell")),o&&i&&(i=i.nextElementSibling);break;case s.JQUERY.EVENT_ID.KEYPRESS.ARROWRIGHT:i=r.nextElementSibling;break;case s.JQUERY.EVENT_ID.KEYPRESS.ARROWDOWN:var c=n.nextElementSibling;c&&(i=c.querySelector(".app_table_cell")),o&&i&&(i=i.nextElementSibling)}i&&(e.preventDefault(),i.querySelector("button").focus())},f.loadFile=function(){n.trackEvent("PopupLoadFile",{filesSelectedCount:f.filesSelected.length}),f.filesSelected.length>1&&n.warn(`loadFile called with ${f.filesSelected.length} files selected`);if(!s.FILE.SUPPORTED_FILE_TYPES[c.default.getFileExtension(f.filesSelected[0].name)])return n.info(`PopupController.loadFile(): User attempted to open an unsupported file type of ${c.default.getFileExtension(f.filesSelected[0].name)} extension`),void d.show(s.NOTIFICATION.UNSUPPORTEDFILETYPE);e=f.filesSelected[0],o.default.extension.getBackgroundPage().postMessage(e,window.location);var e},f.constants=s,f.storage=a,f.userService=u,f.localize=l,f.hasSignedIn=s.SIGNINSTATUS.UNKNOWN,f.currentViewMode=s.MENU_VIEWMODE.NONE,t.userType=s.USER_TYPE.NONE,f.appLaunchers=[[{id:"Outlook",label:"OutlookAppName",iconClass:"ms-BrandIcon--icon48 ms-BrandIcon--outlook",url:s.LINKS.APP.OUTLOOK_DEFAULT,isBusinessOnly:!1},{id:"OneDrive",label:"OneDriveAppName",iconClass:"ms-BrandIcon--icon48 ms-BrandIcon--onedrive",url:s.LINKS.APP.ONEDRIVE,isBusinessOnly:!1}],[{id:"WordOnline",label:"WordAppName",iconClass:"ms-BrandIcon--icon48 ms-BrandIcon--word",url:s.LINKS.APP.WORD,isBusinessOnly:!1},{id:"ExcelOnline",label:"ExcelAppName",iconClass:"ms-BrandIcon--icon48 ms-BrandIcon--excel",url:s.LINKS.APP.EXCEL,isBusinessOnly:!1}],[{id:"PowerPointOnline",label:"PowerPointAppName",iconClass:"ms-BrandIcon--icon48 ms-BrandIcon--powerpoint",url:s.LINKS.APP.POWERPOINT,isBusinessOnly:!1},{id:"OneNoteOnline",label:"OneNoteAppName",iconClass:"ms-BrandIcon--icon48 ms-BrandIcon--onenote",url:s.LINKS.APP.ONENOTE,isBusinessOnly:!1}],[{id:"SharePoint",label:"SharePointSiteAppName",iconClass:"ms-BrandIcon--icon48 ms-BrandIcon--sharepoint",url:s.LINKS.APP.SHAREPOINT_DEFAULT,isBusinessOnly:!0},{id:"Teams",label:"TeamsAppName",iconClass:"ms-BrandIcon--icon48 ms-BrandIcon--teams",url:s.LINKS.APP.TEAMS,isBusinessOnly:!0}]],i.ready((function(){e((function(){n.trackEvent("PopupPageLoad")}));for(var t=document.querySelectorAll(".ms-CheckBox"),r=0;r<t.length;r++)new(T().CheckBox)(t[r])})),a.get(["userType","identity"]).then(e=>{var r=e&&e.identity&&e.userType!==s.USER_TYPE.NONE;return f.hasSignedIn=r?s.SIGNINSTATUS.SIGNEDIN:s.SIGNINSTATUS.NONE,f.hasSignedIn>s.SIGNINSTATUS.NONE&&(n.debug("PopupController.refreshSignInStatus(): Method start"),f.userService.getUserType().then((async function(e){if(n.debug("PopupController.getSignInStatus(): hasSignedIn: "+e),n.trackEvent("PopupSignedIn",{userType:e}),t.userType=e,f.hasSignedIn=e===s.USER_TYPE.NONE?s.SIGNINSTATUS.NONE:s.SIGNINSTATUS.SIGNEDIN,f.hasSignedIn===s.SIGNINSTATUS.SIGNEDIN){var r=await f.userService.waitForUserInfo(e);c.default.isUndefinedOrNull(r)?n.warn("self.UserService.getUserInfo(): userInfo is undefined or null when hasSignedIn is SIGNINSTATUS.SIGNEDIN"):c.default.isUndefinedOrNull(r.email)?n.warn("self.UserService.getUserInfo(): userInfo.email is undefined or null when hasSignedIn is SIGNINSTATUS.SIGNEDIN"):(f.username=r.email,u.getUserPhoto().then((function(e){e&&(f.profilePicture=e)}),(function(e){f.profilePicture="",n.info("PopupController.getUserPhoto: Profile Picture Error - "+e)})))}}))),f.storage.get("webRedirect_disabled")}).then(e=>(f.webRedirectInputChecked=!(c.default.isNotUndefinedOrNull(e.webRedirect_disabled)&&e.webRedirect_disabled),n.getEnabledSetting())).then(e=>(n.setEnabledSetting(e),f.telemetryInputChecked=e,u.useAuthNext())).then(e=>{f.useAuthNext=e})}]).directive("bindFileChange",(function(){return{require:"ngModel",restrict:"A",link:function(e,t,r,n){t.bind("change",(function(e){n.$setViewValue(e.target.files)}))}}})).directive("bindDragAndDrop",["$log",function(e){return{require:"ngModel",restrict:"A",link:function(t,r,n,i){r.bind("dragover",(function(e){e.stopPropagation(),e.preventDefault(),e.originalEvent.dataTransfer.dropEffect="copy"})),r.bind("drop",(function(t){t.stopPropagation(),t.preventDefault(),e.trackEvent("OpenDocument_Local_AppDragAndDrop"),i.$setViewValue(t.originalEvent.dataTransfer.files)}))}}}]).directive("bindFileInputContainerClick",["$log",function(e){return{restrict:"A",link:function(t,r){r.bind("mousedown keydown keypress",(function(t){t.which!==s.JQUERY.EVENT_ID.MOUSEDOWN.LEFT_BUTTON_CLICK&&t.which!==s.JQUERY.EVENT_ID.KEYPRESS.ENTER||(e.trackEvent("OpenDocument_Local"),t.currentTarget.nextElementSibling.click(),t.preventDefault())}))}}}]).config(["$routeProvider",e=>{e.when("/",{templateUrl:"./popup/popup.html",controller:"PopupController",controllerAs:"ctrl"}).otherwise({redirectTo:"/"})}]).name;i().module("app.experimentation",[]).constant("experimentConstants",{DEFAULT_CLIENT_ID:"",ENABLED:{MSA:!0,O365:!1,BROWSERS:["Chrome","Edge"]},ENDPOINT:"http://officeonlineextension-office365.msedge.net/ab",ERROR:{BAD_USER_TYPE:"badUserType",NO_CLIENT_ID:"noClientId",NO_FEATURES:"noFeatures"},EXPERIMENTS:{SHARING:{ENABLED:{MSA:!0,O365:!1,BROWSERS:["Chrome"]},CONTROL:"sharingControl/sharingControl.html",FLIGHTS:{flighttestaacf:"sharingControl/sharingControl.html",flighttestaa:"sharingControl/sharingControl.html",SharingUXCF:"sharingControl/sharingControl.html",SharingUX:"sharingA/sharingA.html"}}}}).factory("experimentService",["$http","$q","$log","experimentConstants","userService",function(e,t,r,n,i){var o,a=null,c={[s.USER_TYPE.MSA]:"MSA",[s.USER_TYPE.O365]:"O365"},u={getFlight:async function(e){if(!await d(e))return n.EXPERIMENTS[e].CONTROL;return(await l())[e]},getFlights:l,flightingDisabled:function(e){return m(e)},experimentEnabled:d};return u;async function l(){return Utilities.isNotUndefinedOrNull(a)?a:Utilities.isNotUndefinedOrNull(null)?(await Promise.all([null]),a):(await async function(){try{var l=await i.getUserType();if(o=c[l],Utilities.isUndefinedOrNull(l)||l===s.USER_TYPE.NONE)throw n.ERROR.BAD_USER_TYPE;if(u.flightingDisabled(l))return void(a=p());var d=await i.waitForUserInfo(l);if(Utilities.isNotUndefinedOrNull(d)&&Utilities.isNotUndefinedOrNull(d.flights))return void(a=d.flights);var m=function(e,t){if(Utilities.isUndefinedOrNull(t))return n.DEFAULT_CLIENT_ID;var r=t.cid||t.id;if(r)return r;return n.DEFAULT_CLIENT_ID}(0,d),T=await function(i){var o=t.defer();if(Utilities.isUndefinedOrNull(i)||i===n.DEFAULT_CLIENT_ID)return r.error("experimentService.getFeatures: clientId is undefined, null, or empty"),o.reject(n.ERROR.NO_CLIENT_ID);var a=(c=function(e){var t,r="";for(t=0;t<e.length;t++)r+=("000"+e.charCodeAt(t).toString(16)).slice(-4);return r}(i),c.length>100?c.substring(0,100):c),s={method:"GET",url:n.ENDPOINT,headers:{"X-MSEDGE-CLIENTID":a}};var c;return e(s).then(e=>{var t=e.data;return t.Features?o.resolve(t.Features):o.reject(n.ERROR.NO_FEATURES)},()=>o.reject(n.ERROR.NO_FEATURES)),o.promise}(m);!function(e){for(var t in a={},n.EXPERIMENTS)n.EXPERIMENTS.hasOwnProperty(t)&&f(e,t);!function(e){for(var t=[],n=0;n<e.length;++n){var i=e[n];E(i)&&t.push(i)}t.length>0&&r.warn("ExP service returned invalid features: "+JSON.stringify(t))}(e)}(T),d.flights=a,d.features=T,await i.saveUserInfo(l,d)}catch(e){r.error("experimentService.setFlights error: "+e),a=p()}}(),a)}async function d(e){try{var t=await i.getUserType();return!u.flightingDisabled(t)&&!m(t,e)}catch(e){return r.error("experimentService.experimentEnabled error: "+e),!1}}function f(e,t){var r=n.EXPERIMENTS[t];if(a[t]=r.CONTROL,r.ENABLED[o])for(var i in r.FLIGHTS)if(r.FLIGHTS.hasOwnProperty(i)&&e.indexOf(i)>-1){a[t]=r.FLIGHTS[i];break}}function p(){var e={};for(var t in n.EXPERIMENTS)if(n.EXPERIMENTS.hasOwnProperty(t)){var r=n.EXPERIMENTS[t];e[t]=r.CONTROL}return e}function E(e){for(var t in n.EXPERIMENTS){if(n.EXPERIMENTS.hasOwnProperty(t))if(n.EXPERIMENTS[t].FLIGHTS.hasOwnProperty(e))return!1}return!0}function m(e,t){if(e===s.USER_TYPE.NONE)return!0;var i=n.EXPERIMENTS.hasOwnProperty(t)?n.EXPERIMENTS[t].ENABLED:n.ENABLED,o=t?`experiment ${t} is`:"all experiments are",a=Utilities.getBrowserName().toLowerCase(),u=i.BROWSERS.toString().toLowerCase();if(u.indexOf(a)<0)return r.info(`experimentService: ${o} disabled for browser ${a}. Experiment is only enabled for browsers ${u}`),!0;var l=i[c[e]];return l||r.info(`experimentService: ${o} disabled for userType ${e}`),!l}}]).controller("SharingController",["experimentService",function(e){var t=this,r="/experimentation/sharing/";t.flightView=r+"sharingControl/sharingControl.html",e.getFlight("SHARING").then((function(e){t.flightView=r+e}))}]).factory("sharingService",["$http","$q","$log","userService",function(e,t,r,n){return{setShareUrl:function(e,t){if(c.default.isUndefinedOrNull(e)||c.default.isUndefinedOrNull(e.url))return;if(e.shareUrl="",t===s.USER_TYPE.MSA){var r=e.url.replace("&page=view","&page=self");r.indexOf("&page=self")<0&&(r+="&page=self"),r+="&action=share",e.shareUrl=r}},setFlagFromPermissions:function(i,o){if(c.default.isUndefinedOrNull(i))return t.resolve();if(o===s.USER_TYPE.MSA){var a=t.defer();return function(r){var i=t.defer();return function(){var e=t.defer();return n.waitForUserInfo(s.USER_TYPE.MSA).then((function(t){c.default.isUndefinedOrNull(t)?e.resolve(null):e.resolve(t.cid)})),e.promise}().then((function(t){if(c.default.isUndefinedOrNull(t))i.reject("null cid");else if(c.default.isUndefinedOrNull(r.id))i.reject("no document id");else{var n=r.id.split("."),o=n[n.length-1],a={method:"GET",url:s.MSACONFIG.ONEDRIVE_ITEMS_URL+o+"/permissions",headers:{"X-UserType":s.USER_TYPE.MSA}};e(a).then((function(e){var r=function(e,t){if(c.default.isUndefinedOrNull(e)||c.default.isUndefinedOrNull(e.value))return!0;for(var r=!0,n=t.substring(1,t.length),i=0;i<e.value.length;++i){var o=e.value[i];if(!c.default.isUndefinedOrNull(o.grantedTo)){var a=o.grantedTo.user;if(a.id===t||a.id===n)r=o.roles.toString().toLowerCase().indexOf("write")>-1}}return r}(e.data,t);i.resolve(r)}),(function(e){i.reject(e.statusText)}))}})),i.promise}(i).then((function(e){i.canBeShared=e,a.resolve()}),(function(e){r.error("sharingService.setFlagFromPermissions error: "+e),i.canBeShared=!1,a.resolve()})),a.promise}return i.canBeShared=!1,t.resolve()}}}]).controller("SharingAController",["$log","sharingService","userService","localize",function(e,t,r,n){var i=this;i.shareDoc=null,i.isChrome=c.default.isChrome(),i.localize=n,i.init=function(e){i.shareDoc=e,r.getUserType().then((function(e){t.setShareUrl(i.shareDoc,e),t.setFlagFromPermissions(i.shareDoc,e)}))},i.shareDocument=function(t){e.trackEvent("ShareRecentDocument",{application:i.shareDoc.application});var r=!(!c.default.isUndefinedOrNull(t)&&!c.default.isUndefinedOrNull(t.ctrlKey))||!t.ctrlKey;c.default.navigateToUrlWithNewTab(i.shareDoc.shareUrl,r),window.close()}}]).name,i().module("app",["localization","ngAria","app.common","app.diagnostics","app.experimentation","app.user","app.mru","app.popup"]).config(["$ariaProvider","$compileProvider","$httpProvider","$provide",function(e,t,r,n,i){e.config({tabindex:!1}),t.imgSrcSanitizationWhitelist(/^\s*(https?|data|chrome-extension|ms-browser-extension):/)}]).name},8096:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=[],n={};t.default=function(){var e=(()=>{if("object"==typeof browser){var e=Object.create(browser);e.notifications={clear:function(e,t){t(!1)},create:function(e,t,r){null!=t&&void 0!==t.priority&&null!==t.priority&&t.priority>0&&window.alert(t.message),r(e)},onButtonClicked:{addListener:function(e){}},onClicked:{addListener:function(e){}}},e.runtime={getPlatformInfo:function(e){}}}else if("object"==typeof chrome)return Object.create(chrome)})();if(window.jasmine){e=function e(t,r){for(const[n,i]of Object.entries(r))t[n]?typeof i==typeof t[n]?Array.isArray(i)?t[n]=t[n].concat(i):t[n]="object"!=typeof i?i:e(t[n],i):console.log(`skipping ${n} due to conflicting types`):t[n]=i;return t}(e||{},{mock:!0,browserAction:{setIcon:function(e){}},extension:{getURL:function(e){return""}},i18n:{getUILanguage:function(e,t){return""},getMessage:function(){return""}},runtime:{onMessage:{addListener:function(e){r.push(e)},removeListener:function(e){r.splice(r.indexOf(e),1)}},sendMessage:function(e){for(let t=0;t<r.length;++t)r[t](e)},id:"ndjpnladcallmjemlbaebfadecfhkepb"},storage:{local:{get:function(e,t){t({[e]:n[e]})},set:function(e){for(const t in e)e.hasOwnProperty(t)&&(n[t]=e[t])},remove:function(e,t){delete n[e],t(n)},clear:function(e,t){n={}}}},tabs:{create:function(e,t){t&&t({})}}}),window.chrome||(window.chrome=e)}return window.BrowserHandler||(window.BrowserHandler=e),e}()},6811:(e,t,r)=>{"use strict";const n=r(8096);window.Utilities||(window.Utilities={deserializeQuery:function(e){var t,r=/\+/g,n=/([^&=]+)=?([^&]*)/g,i=function(e){return decodeURIComponent(e.replace(r," "))},o={};for(t=n.exec(e);t;)o[i(t[1])]=i(t[2]),t=n.exec(e);return o},getFileExtension:function(e){var t="";if(e){var r=e.match(/(?:\.)(\w+)$/);r&&r.length>1&&(t=r[r.length-1].toLowerCase())}return t},navigateToUrlWithNewTab:function(e,t,r){n.default.tabs.create({url:e,active:!!this.isUndefinedOrNull(t)||t},r)},safeOpenNewTab:function(e,t,r){n.default.windows.getAll((function(i){0===i.length?n.default.windows.onCreated.addListener(()=>this.navigateToUrlWithNewTab(e,t,r)):this.navigateToUrlWithNewTab(e,t,r)}))},isNotUndefinedOrNull:function(e){return!this.isUndefinedOrNull(e)},isUndefinedOrNull:function(e){return null==e},isExtensionInTestingMode:function(){return this.isNotUndefinedOrNull(window.jasmine)},isExtensionInDevelopmentMode:function(){if(this.isExtensionInTestingMode())return!1;if(window.browser&&window.browser.extension){var e=n.default.runtime.getURL("");if(null!=e&&/_microsoftofficeonline_/i.test(e))return!1}if(window.chrome&&window.chrome.extension){var t=this.getManifest();if(null==t)return!1;if(void 0!==t.key||void 0!==t.update_url)return!1}return!0},getAppDescription:function(){if(window.chrome&&window.chrome.extension)return this.getManifest().description},getManifest:function(){if("object"!=typeof n.default.runtime||"function"!=typeof n.default.runtime.getManifest)return null;var e=n.default.runtime.getManifest();return null==e?null:e},isBackgroundContext:function(){var e=window.location.href;return!!(window.browser&&window.browser.extension&&/^ms-browser-extension/.test(e)&&window===n.default.extension.getBackgroundPage())||!!(window.chrome&&window.chrome.extension&&/^chrome/.test(e)&&window===n.default.extension.getBackgroundPage())},getCurrentTime:function(){return Math.round((new Date).getTime()/1e3)},isChrome:function(){return"Chrome"===this.getBrowserName()&&window.navigator.vendor.indexOf("Google")>-1},getBrowserAndVersion:function(){if(!this.browserVersion){const e=e=>{const t=new RegExp(`(?<browser>${e})/(?<version>[0-9.]+)`,"i"),r=window.navigator.userAgent.match(t);if(r&&r.groups)return r.groups;if(window.navigator.userAgentData){const t=window.navigator.userAgentData.brands.find(t=>t.brand.match(new RegExp(e,"i")));if(t)return{browser:t.brand,version:t.version}}},t=["OPe?R","Edge?","Chrome","Safari","Firefox"];for(const r of t){const t=e(r);if(t){this.browserVersion=t;break}}}return this.browserVersion},getBrowserName:function(){const e=this.getBrowserAndVersion();return e?e.browser:"Chrome"},isRTL:function(){var e=n.default.i18n.getUILanguage();return!!(/^ar/i.test(e)||/^fa/i.test(e)||/^he/i.test(e))},setIcon:function(e){n.default.browserAction.setIcon({path:e})}}),t.default=window.Utilities},454:()=>{!function(){"use strict";var e=window.BrowserHandler;e||(e=chrome||browser),angular.module("localization",[]).factory("localize",["$filter",function(t){return{getLocalizedString:function(t){return e.i18n.getMessage(t)}}}]).filter("i18n",["localize",function(e){return function(t){return e.getLocalizedString(t)}}]).directive("i18n",["localize",function(e){var t={restrict:"EAC",updateText:function(t,r){var n=r.split("|");if(!(n.length<=1)){var i=e.getLocalizedString(n[0]);if(i){for(var o=1;o<n.length;o++){var a="{"+(o-1)+"}";i=i.replace(a,n[o])}t.text(i)}}},link:function(e,r,n){n.$observe("i18n",(function(e){t.updateText(r,n.i18n)}))}};return t}]).directive("i18nAttr",["localize",function(e){var t={restrict:"EAC",updateText:function(t,r){var n=r.split("|");if(!(n.length<2)){var i=e.getLocalizedString(n[0]);if(i){for(var o=2;o<n.length;o++){var a="{"+(o-2)+"}";i=i.replace(a,n[o])}t.attr(n[1],i)}}},link:function(e,r,n){n.$observe("i18nAttr",(function(e){t.updateText(r,e)}))}};return t}])}()}},r={};function n(e){var i=r[e];if(void 0!==i)return i.exports;var o=r[e]={exports:{}};return t[e].call(o.exports,o,o.exports,n),o.exports}n.m=t,e=[],n.O=(t,r,i,o)=>{if(!r){var a=1/0;for(l=0;l<e.length;l++){for(var[r,i,o]=e[l],s=!0,c=0;c<r.length;c++)(!1&o||a>=o)&&Object.keys(n.O).every(e=>n.O[e](r[c]))?r.splice(c--,1):(s=!1,o<a&&(a=o));if(s){e.splice(l--,1);var u=i();void 0!==u&&(t=u)}}return t}o=o||0;for(var l=e.length;l>0&&e[l-1][2]>o;l--)e[l]=e[l-1];e[l]=[r,i,o]},n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={213:0};n.O.j=t=>0===e[t];var t=(t,r)=>{var i,o,[a,s,c]=r,u=0;if(a.some(t=>0!==e[t])){for(i in s)n.o(s,i)&&(n.m[i]=s[i]);if(c)var l=c(n)}for(t&&t(r);u<a.length;u++)o=a[u],n.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return n.O(l)},r=self.webpackChunkofficechromeextension=self.webpackChunkofficechromeextension||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})();var i=n.O(void 0,[216],()=>n(5939));i=n.O(i)})();